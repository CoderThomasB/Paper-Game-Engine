<!DOCTYPE html>
<html>

<body>
	<!--<img src="/Cell Man/wall.svg" style="display: none;" id="img wall">
		<img src="/Cell Man/wall flipped.svg" style="display: none;" id="img wall flipped">
		<img src="/Cell Man/Wall End Up.svg" style="display: none;" id="img wall end up">
		<img src="/Cell Man/Wall End Down.svg" style="display: none;" id="img wall end down">
		<img src="/Cell Man/Wall End Left.svg" style="display: none;" id="img wall end left">
		<img src="/Cell Man/Wall End Right.svg" style="display: none;" id="img wall end right">

		<img src="/Cell Man/PacMan.svg" style="display: none;" id="img PacMan">
		<img src="/Cell Man/CellMan.svg" style="display: none;" id="img CellMan">
		<img src="/Cell Man/CellMan Eat.svg" style="display: none;" id="img CellMan Eat">
		<img src="/Cell Man/CellMan Eating.svg" style="display: none;" id="img CellMan Eating">
		<img src="/Cell Man/Food.svg" style="display: none;" id="img Food">-->
	<canvas id="match" style="width: 500px; border: 1px solid; margin: auto; float: right;" width="500"
		height="500"></canvas>

	<div id="The_new_div" style="
		margin: 10px;
		padding: 10px;
		background-color: hsla(0, 0%, 0%, 0.1);
		width: max-content;
		border-radius: 10px;
	">
		<button style="float: left; margin-right: 1em;" id="The_new_div_button">new</button>
		<textarea id="The_new_div_textarea" cols="40" rows="1">physics(The_world, new location2D(1,1))</textarea>
	</div>
	<ul id="object properties" style="
    	list-style: none;
    	margin: 0px;
		padding: 0px;
		float: right;
	">
	</ul>
	<button id="Button_select_object" style="
	background-color: rgba(0, 0, 0, 0.1);
	border-radius: 10px;
	margin: 10px;
	padding: 10px;">
		select an object
		<script>
			The_Button_select_object = document.getElementById("Button_select_object")

			The_Button_select_object.addEventListener("click", (event1) => {
				console.log(event1.target)
				event1.target.disabled = true
				The_select.this_world = The_world
				The_world.grid.push(The_select)
				let mousemove = The_canvas.addEventListener("mousemove", update_The_select)
				The_canvas.addEventListener("click", (event2) => {
					The_canvas.removeEventListener("mousemove", update_The_select)
					The_select.destroy()
					The_location = new location2D(0, 0)
					The_location.x = Math.floor(event.offsetX / The_canvas.clientWidth * The_camera.screen_size.x)
					The_location.y = Math.floor(event2.offsetY / The_canvas.clientHeight * The_camera.screen_size.y)
					event1.target.disabled = false
					The_objects = The_world.get_at_location(The_location)
					if (The_objects.length >= 1) {
						show_properties(The_world.get_at_location(The_location)[0])
					}
				}, { once: true })
			})
		</script>
	</button>
	<ul id="grid list" style="
		list-style: none;
		margin: 0px;
		padding: 0px;
	">
		<li>The_world (world)</li>
		<li>The_camera (camera)</li>
		<li>The_Test (visible)</li>
		<li></li>
	</ul>

	<script type="text/javascript" src="main.js"></script>
	<script>
		The_canvas = document.getElementsByTagName("canvas")[0]

		The_world = new world()
		The_world.size = new location2D(10, 10)
		The_camera = new camera(The_world, new location2D(0, 0), The_canvas, new location2D(10, 10))

		The_visible = new visible(The_world, new location2D(1, 1))

		The_select = new visible(The_world, new location2D(1, 1))
		The_select.visible[0].colour = "hsl(200deg 84% 61%)"
		The_select.destroy()

		The_new_div_textarea = document.getElementById("The_new_div_textarea")
		The_new_div_button = document.getElementById("The_new_div_button")
		The_new_div = document.getElementById("The_new_div")
		The_grid_list = document.getElementById("grid list")
		The_object_properties = document.getElementById("object properties")


		The_new_div_button.addEventListener("click", (event) => {
			eval("new " + The_new_div_textarea.value)
			update_list()
			show_properties(The_world.grid[The_world.grid.length - 1])
		})

		function draw_function() {
			The_world.update()
			The_camera.draw()

		}

		function update_The_select(event) {
			The_select.location.x = Math.floor(event.offsetX / The_canvas.clientWidth * The_camera.screen_size.x)
			The_select.location.y = Math.floor(event.offsetY / The_canvas.clientHeight * The_camera.screen_size.y)
		}

		function update_list() {
			The_grid_list.innerHTML = ""
			let i = 0
			The_world.grid.forEach(
				element => {
					i++
					The_li = The_grid_list.appendChild(document.createElement("LI"))
					The_Button = The_grid_list.appendChild(document.createElement("BUTTON"))
					The_Button.style.backgroundColor = "hsla(0, 0%, 0%, 0.1)"
					The_Button.style.borderRadius = "10px"
					The_Button.style.margin = "10px"
					//The_Button.style.width = "fit-content"
					The_Button.style.padding = "10px"
					if (element.name != undefined && element.name != "") {
						The_Button.innerHTML = "<li>[" + i + "]" + element.name + "(" + element.constructor.name + ")</li>"
					} else {
						The_Button.innerHTML = '<li>[' + i + '] a ' + element.constructor.name + "</li>"
					}
					The_Button.addEventListener("click", () => {
						show_properties(element)
					})
				})
		}
		function show_property(object, key, value, containing_Div) {
			The_Div = containing_Div
			The_Name = The_Div.appendChild(document.createElement("input"))
			The_Span = The_Div.appendChild(document.createElement("span"))

			The_Div.style.margin = "10px"
			The_Div.style.padding = "10px"
			The_Div.style.backgroundColor = "hsla(0, 0%, 0%, 0.1)"
			The_Div.style.width = "max-content"
			The_Div.style.borderRadius = "10px"
			The_Div.style.display = "inline-block"
			The_Span.innerHTML = " = "
			The_Span.style.marginLeft = "1em"
			The_Span.style.marginRight = "1em"
			The_Name.style.float = "left"
			The_Name.style.width = "7em"
			The_Span.style.float = "left"

			if (value == undefined) {
				The_Value = The_Div.appendChild(document.createElement("span"))
				The_Value.innerHTML = "undefined"
				The_Name.innerHTML = key
				return
			}
			switch (value.constructor) {
				case Boolean:
					The_Value = The_Div.appendChild(document.createElement("input"))
					break
				case Object:
					The_Value = The_Div.appendChild(document.createElement("DIV"))
					break
				case Array:
					The_Value = The_Div.appendChild(document.createElement("ul"))
					break
				default:
					The_Value = The_Div.appendChild(document.createElement("textarea"))
					break
			}


			switch (value.constructor) {
				case Object:
					/*The_Name.value = key
					The_Value.value = JSON.stringify(value)
					The_Value.value.replace("{", "{\n")*/
					//show_property(Object.keys(value)[0], value[Object.keys(value)[0]], The_Value)
					break
				case Boolean:
					The_Name.value = key
					The_Value.type = "checkbox"
					The_Value.checked = value
					console.log(The_Value)
					break
				case Array:
					The_Name.value = key
					let The_Array_li
					for (let i = 0; i < value.length; i++) {
						The_Array_li = The_Value.appendChild(document.createElement("li"))
						show_property(value, i, value[i], The_Array_li)
					}
					The_Array_li = The_Value.appendChild(document.createElement("LI"))
					let The_Array_li_button = The_Array_li.appendChild(document.createElement("button"))
					The_Array_li_button.innerHTML = "Add"

					break
				case location2D:
					The_Name.value = key
					The_Value.value = value

					let The_Button = The_Div.appendChild(document.createElement("button"))
					The_Button.style.backgroundColor = "hsla(0, 0%, 0%, 0.1)"
					The_Button.style.borderRadius = "10px"
					The_Button.style.margin = "10px"
					The_Button.style.float = "right"
					The_Button.innerHTML = "select the location"
					The_Button.addEventListener("click", (event1) => {
						console.log(event1.target)
						event1.target.disabled = true
						The_select.this_world = The_world
						The_world.grid.push(The_select)
						let mousemove = The_canvas.addEventListener("mousemove", update_The_select)
						The_canvas.addEventListener("click", (event2) => {
							The_canvas.removeEventListener("mousemove", update_The_select)
							The_select.destroy()
							object[key].x = Math.floor(event.offsetX / The_canvas.clientWidth * The_camera.screen_size.x)
							object[key].y = Math.floor(event2.offsetY / The_canvas.clientHeight * The_camera.screen_size.y)
							event1.target.disabled = false
							show_properties(object)
						}, { once: true })
					})
					break
				default:
					The_Name.value = key
					The_Value.value = value
					break
			}
			The_Name.addEventListener("change", (event) => {
				Object.defineProperty(object, event.target.value,
					Object.getOwnPropertyDescriptor(object, key));
				delete object[key];
				show_properties(object)
			})

			The_Value.addEventListener("change", (event) => {
				console.log(typeof (Object.getOwnPropertyDescriptor(object, key).value))
				console.log(Object.getOwnPropertyDescriptor(object, key).value.constructor)
				let The_parse;
				switch (Object.getOwnPropertyDescriptor(object, key).value.constructor) {
					case Object:
						console.log(JSON.parse(event.target.value))
						Object.defineProperty(object, key, { value: JSON.parse(event.target.value) })
						break
					case location2D:
						The_parse = JSON.parse(event.target.value)
						Object.getOwnPropertyDescriptor(object, key).value.x = The_parse.x
						Object.getOwnPropertyDescriptor(object, key).value.y = The_parse.y

						let The_Button = The_Div.appendChild(document.createElement("button"))
						The_Button.style.backgroundColor = "hsla(0, 0%, 0%, 0.1)"
						The_Button.style.borderRadius = "10px"
						The_Button.style.margin = "10px"
						The_Button.style.float = "right"
						The_Button.innerHTML = "select the location"
						The_Button.addEventListener("click", (event1) => {
							console.log(event1.target)
							event1.target.disabled = true
							The_select.this_world = The_world
							The_world.grid.push(The_select)
							let mousemove = The_canvas.addEventListener("mousemove", update_The_select)
							The_canvas.addEventListener("click", (event2) => {
								The_canvas.removeEventListener("mousemove", update_The_select)
								The_select.destroy()
								object[key].x = Math.floor(event.offsetX / The_canvas.clientWidth * The_camera.screen_size.x)
								object[key].y = Math.floor(event2.offsetY / The_canvas.clientHeight * The_camera.screen_size.y)
								event1.target.disabled = false
								show_properties(object)
							}, { once: true })
						})
						break
					case Number:
						Object.defineProperty(object, key, { value: parseInt(event.target.value) })
						console.log(parseInt(event.target.value))
						break
					case Boolean:
						Object.defineProperty(object, key, { value: event.target.checked })
						console.log(The_parse)
				}
				show_properties(object)
			})
		}
		function show_properties(object) {
			The_object_properties.innerHTML = ""
			Object.keys(object).forEach(
				key => {
					value = object[key]
					The_li = The_object_properties.appendChild(document.createElement("LI"))
					The_Div = The_li.appendChild(document.createElement("div"))
					show_property(object, key, value, The_Div)
				})
		}



		draw = setInterval(draw_function, 10)
		draw_function()
		update_list()
	</script>
</body>

</html>